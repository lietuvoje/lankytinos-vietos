<!DOCTYPE html>
<html>
  <head>
    <title>Lietuvoje</title>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
      #controls button {
        margin: 5px;
      }
      #layers { display: none; }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUFIaxJ56KysGZGUyuwwy1qvAtucjMQF0&sensor=false">
    </script>
    <script type="text/javascript">
      var map = null;
      var layers = {};

      $(function() {
        createMap();
        createPopover();
        createLayers();
      });

      function createMap() {
        var lithuania = new google.maps.LatLng(55.254980, 23.969568);
        var mapOptions = {
          zoom: 11,
          center: lithuania
        };

        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

        homeControlDiv = document.getElementById("controls");
        map.controls[google.maps.ControlPosition.TOP_RIGHT].push(homeControlDiv);
      }

      function createPopover() {
        $('#visible-layers').popover({
          container: "body",
          placement: "bottom",
          html : true,
          content: function() {
            return $('#layers').html();
          }
        });

        $('body').on('click', '.layer', function (event) {
          var element = $(event.target)
          var name = element.data("name")
          $(element).toggleClass("active");
          // When popover is closed, its DOM elements are destroyed.
          // We have to set correct class for the original, so that
          // recreated popover has correct state
          $('#layers .layer[data-name="'+name+'"]').toggleClass("active");
          showActiveLayers();
        });
      }

      function createLayers() {
        $("#layers .layer").each(function(index, element) {
          var name = $(element).data("name");
          layers[name] = new google.maps.KmlLayer({
            url: 'http://www.ltoncar.lt/kml/' + name + '/doc_lt.kml'
          });
          toggleLayer(element, name);
        });
      }

      function showActiveLayers() {
        // Selecting popover llayers, not the original ones
        $(".popover-content .layer").each(function(index, element) {
          var name = $(element).data("name");
          toggleLayer(element, name);
        });
      }

      function toggleLayer(element, name) {
        if ($(element).hasClass("active")) {
          layers[name].setMap(map);
        }
        else {
          layers[name].setMap(null);
        }
      }
    </script>
  </head>
  <body>
    <div id="map-canvas">
    </div>

    <div id="controls">
      <button id="visible-layers" type="button" class="btn btn-primary btn-xs" data-toggle="popover">
        Rodomos vietos
      </button>
      <button type="button" class="btn btn-primary btn-xs">
        <a href="https://github.com/lietuvoje/lietuvoje.github.io">Prisidėk!</a>
      </button>
    </div>

    <ul id="layers" class="list-group">
      <li class="layer list-group-item active" data-name="lankytinu_vietu_top">Populiarios</li>
      <li class="layer list-group-item" data-name="baznyciosb">Bažnyčios</li>
      <li class="layer list-group-item" data-name="dvaraib">Dvarai</li>
      <li class="layer list-group-item" data-name="gamtos_paminklaib">Gamtos Paminklai</li>
      <li class="layer list-group-item" data-name="ivykiaib">Įvykiai</li>
      <li class="layer list-group-item" data-name="kitab">Kita</li>
      <li class="layer list-group-item" data-name="malunaib">Malūnai</li>
      <li class="layer list-group-item" data-name="muziejaib">Muziejai</li>
      <li class="layer list-group-item" data-name="piliakalniai">Piliakalniai</li>
      <li class="layer list-group-item" data-name="pilysb">Pilys</li>
      <li class="layer list-group-item" data-name="pramogosb">Pramogos</li>
      <li class="layer list-group-item" data-name="religines_pagoniu_vietosb">Pagonių Vietos</li>
      <li class="layer list-group-item" data-name="saugomos_teritorijosb">Saugomos Teritorijos</li>
      <li class="layer list-group-item" data-name="vandens_malunaib">Vandens Malūnai</li>
      <li class="layer list-group-item" data-name="marsrutai_kryptys">Maršrutai</li>
    </ul>
  </body>
</html>